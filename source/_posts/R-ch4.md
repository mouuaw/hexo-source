---
title: 4장 데이터 조작 1
date: 2019-03-20 22:55:14
tags:
- R
---

## 01 아이리스 데이터

아이리스 데이터는 R에 기본으로 내장되어 있고, 이해하기 쉬우며 크기가 작고 기계 학습에서 인기 있는 분야 중 하나인 분류에 적합한 데이터다. 이런 이유로 아이리스는 R뿐만 아니라 다른 데이터 분석이나 기계학습 관련 라이브러리에서 자주 사용되고 있다.

* 아이리스 데이터

Species(Factor): 붓꽃의 종. setosa, versicolor, virginica 세 가지 값 중 하나
Sepal.Width(Number): 꽃받침의 너비
Sepal.Length(Number): 꽃받침의 길이
Petal.Width(Number): 꽃잎의 너비
Petal.Length(Number): 꽃잎의 길이

```R
> head(iris)

  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1         5.1         3.5         1.4         0.2   setosa
2         4.9         3.0         1.4         0.2   setosa
3         4.7         3.2         1.3         0.2   setosa
4         4.6         3.1         1.5         0.2   setosa
5         5.0         3.6         1.4         0.2   setosa
6         5.4         3.9         1.7         0.4   setosa

> str(iris)

'data.frame':    150 obs. of 5 variables:
 $ Sepal.Length: num 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
 $ Sepal.Width : num 3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
 $ Petal.Length: num 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
 $ Petal.Width : num 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
 $ Species : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ..
```

iris에는 붓꽃 데이터가 데이터 프레임으로 저장되어 있는 반면, iris3에는 3차월 배열 형태로 저장되어 있다.

이외에도 R에는 다양한 데이터 셋이 준비되어 있다. datasets 패키디에 있는 데이터 셋은 R에 기본적으로 포함된 데이터들이며, 이 데이터의 목록은 library(help=datasets) 명령으로 살펴볼 수 있다.

* AirPassenger: 1949년부터 1960년까지의 항공기 승객 수
* airquality: 1973년 5월부터 9월까지의 뉴욕 대기 오염 정도에 대한 기록
* cars: 자동차의 주행 속도에 따른 제동 거리
* mtcars: 1974년 미국 모터 트렌드 매거진에 실린 32개 자동차에 대해 연료 효율을 비롯한 10여 가지 특징을 기록
* Titanic: 타이타닉 호의 생존자 정보를 호실(1등실, 2등실, 3등실), 성별, 나이, 생존 여부로 정리
* InsectSprays: 6종류의 살충제를 사용했을 때 각 살충제에 대해 살아남은 벌레의 수
* Orange: 오렌지 나무의 종류, 연령, 둘레
* swiss: 1888년경 프랑스어를 사용하는 스위스 내 47개 주의 출산율과 사회 경제적 지표(농업 종사자 비율, 군 입대 시험 성적, 교육 등)

이들 데이터를 사용할 때는 'data(데이터 셋 이름)' 명령을 사용한다. 예를들어, mtcars를 살펴보려면 다음과 같은 명령을 사용한다.

```R
> data(mtcars)
> head(mtcars)
```
mtcars 데이터 셋의 상세 내용르 알고 싶다면 ?mtcars 또는 help(mtcars) 명령을 사용한다.

## 02 파일 입출력

### CSV 파일 입출력

```R
read.csv: CSV 파일을 데이터 프레임으로 읽어들인다.
read.csv(
  file, # 파일명
  header=FALSE, # 파일의 첫 행을 헤더로 처리할 것인지 여부
  # 데이터에 결측치가 포함되어 있을 경우 R의 NA에 대응시킬 값을 지정한다.
  # 기본값은 "NA"로, "NA"로 저장된 문자열들은 R의 NA로 저장된다.
  na.strings="NA",
  # 문자열을 팩터로 저장할지 또는 문자열로 저장할지 여부를 지정하는 데 사용한다. 별다른
  # 설정을 하지 않았다면 기본값은 보통 TRUE다.
  stringsAsFactors=default.stringsAsFactors()
)

반환 값은 데이터 프레임이다.

write.csv: 데이터 프레임을 csv로 저장한다.
write.csv(
  x, # 파일에 저장할 데이터 프레임 또는 행렬
  file="", # 데이터를 저장할 파일명
  row.names=TRUE # TRUE면 행 이름을 CSV 파일에 포함하여 저장한다.
)
```

```R
> (x <- read.csv("a.csv")) # a.csv 파일을 읽어온다.
```
읽어들인 파일은 데이터 프레임형식으로 읽어온다.

다음과 같이 헤더가 없는 csv파일도 존재한다.
```R
1,"Mr. Foo",95
2,"Ms. Bar",97
3,"Mr. Baz",92
```
이렇게 헤더가 없는 경우 header=FALSE 를 지정해준다. 다음과 같이 names() 를 통해서 컬럼 이름을 지정해줘야 한다.
```R
> (x <- read.csv("b.csv"), header=FALSE)
> names(x) <- c("id", "name", "score")
> x
```

문자열 데이터의 경우 별 다른 설정이 없으면 factor로 읽어들인다. as.character() 를 사용해서 문자열로 바꿔주거나 파일을 불러올때 부터 stringsAsFactors를 사용해주면 된다.

```R
> x <- read.csv("a.csv", stringsAsFactors=FALSE)
```

### 파일 데이터에 NA값이 있을 경우

파일 데이터에 정상적인 값이 들어있지 않은경우가 있다. 이럴경우 na.strings() 를 사용하면 된다.
na.strings() 는 주어진 문자열을 R이 인식하는 NA로 바꿔준다.
```R
> x <- read.csv("c.csv", na.strings=c("NIL"))
```

데이터를 CSV 파일로 저장하려면 write.csv()를 사용한다. 다음 예에서는 row.names를 FALSE로 지정하여 행 이름은 제외하고 파일에 저장한다.
```R
> write.csv(x, "d.csv", row.names=FALSE)
```

### 객체의 파일 입출력

바이너리 파일로 R 객체를 저장하고 불러들이는 함수에는 save(), load()가 있다.

```R
save: 메모리에 있는 객체를 파일에 저장한다.
save(
  ..., # 저장할 객체의 이름
  list=character(), # 저장할 객체의 이름을 백터로 지정할 경우 ... 대신 사용
  file # 파일명
)

load: 파일로부터 객체를 메모리로 읽어들인다.
load(
  file # 파일명
)
반환 값은 파일에서 읽어들인 객체의 이름들을 저장한 벡터다.
```

## 03 데이터 프레임의 행과 컬럼 합치기

* rbind(...) 지정한 데이터들을 행으로 취급해 합친다.
* cbind(...) 지정한 데이터들을 컬럼으로 취급해 합친다.

예들 들어, c(1,2,3), c(4,5,6) 이라는 두 벡터는 rbind()를 사용해 각 벡터를 한 행으로 하는 행렬로 합칠 수 있다.

```R
> rbind(c(1,2,3), c(4,5,6))
     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6
```
마찬가지로 데이터 프레임 역시 rbind()를 사용하여 행을 합칠 수 있다. 

## 04 apply 계열 함수

R에는 벡터, 행렬 또는 데이터 프레임에 임의의 함수를 적용한 결과를 얻기 위한 apply 계열 함수가 있다. 이 함수들은 데이터 전체에 함수를 한 번에 적용하는 벡터 연산을 수행하므로 속도가 빠르다.

### apply()

```R
apply: 배열 또는 행렬에 함수 FUN을 MARGIN 방향으로 적용하여 결과를 벡터, 배열 또는 리스트로 반환한다.
apply(
  X, # 배열 또는 행렬
  MARGIN, # 함수를 적용하는 방향. 1은 행 방향, 2는 열 방향
          # c(1, 2)는 행과 열 방향 모두를 의미
  FUN     # 적용할 함수
)

반환 값은 FUN이 길이 1인 벡터들을 반환한 경우 벡터, 1보다 큰 벡터들을 반환한 경우 행렬, 서로 다른 길이의 벡터를 반환한 경우 리스트다.
```

합을 구하는 함수 sum()을 apply()에 적용하는 예에 대해 알아보자. sum()은 인자로 주어진 값들의 합을 구하는 간단한 함수다.

```R
> d <- matrix(1:9, ncol=3)
> d
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
> apply(d, 1, sum)
[1] 12 15 18
> apply(d, 2, sum)
[1] 6 15 24
```

행 또는 열의 합 그리고 평균의 계산은 빈번히 사용되므로 관련 함수들이 미리 정의되어 있다. 

```R
rowSums: 숫자 배열 또는 데이터 프레임에서 행의 합을 구한다.
rowSums(
  x, # 배열 또는 숫자를 저장한 데이터 프레임
  na.rm=FALSE, # NA를 제외할지 여부
)
반환 값은 행 방향에 저장된 값의 합이다.

rowMeans: 숫자 배열 또는 데이터 프레임에서 행의 평균을 구한다.
rowMeans(
  x, # 배열 또는 숫자를 저장한 데이터 프레임
  na.rm=FALSE, # NA를 제외할지 여부
)
반환 값은 행 방향에 저장된 값의 평균이다.
```

colSums(), colMeans() 역시 같은 형식으로 사용하면 된다.

### lapply()

```R
lapply: 벡터, 리스트, 표현식, 데이터 프레임 등에 함수를 적용하고 그 결과를 리스트로 반환한다.
lapply(
  X, # 벡터, 리스트, 표현식 또는 데이터 프레임
  FUN, # 적용할 함수
  ... # 추가 인자. 이 인자들은 FUN에 전달된다.
)
반환 값은 X와 같은 길이의 리스트다.
```
리스트 보다는 벡터 또는 데이터 프레임이 사용하기에 직관적인 면이 있으므로 lapply()의 결과를 벡터 또는 데이터 프레임으로 변환할 필요가 있다.
```R
unlist: 리스트 구조를 벡터로 변환한다.
unlist(
  x, # R 객체. 보통 리스트 또는 벡터
  recursive=FALSE, # x에 포함된 리스트 역시 재귀적으로 변환할지 여부
  use.names=TRUE # 리스트 내 값의 이름을 보존할지 여부
)
반환 값은 벡터다.

do.call: 함수를 리스트로 주어진 인자에 적용하여 결과를 반환한다.
do.call(
  what, # 호출할 함수
  args, # 함수에 전달할 인자의 리스트
)
반환 값은 함수 호출 결과다.
```

lapply()는 인자로 리스트를 받을 수 있다.
```R
> (x <- list(a=1:3, b=4:6))
$a
[1] 1 2 3

$b
[1] 4 5 6
> lapply(x, mean)
$a
[1] 2

$b
[1] 5
```

데이터 프레임에도 곧바로 lapply()를 적용할 수 있다.

### sapply()

sapply() 는 lapply()와 유사하지만 리스트 대신 행렬, 벡터 등의 데이터 타입으로 결과를 반환하는 특징이 있는 함수다.

```R
sapply: 벡터, 리스트, 표현식, 데이터 프레임 등에 함수를 적용하고 그 결과를 벡터 또는 행렬로 반환한다.
sapply(
  X, # 벡터, 리스트, 표현식 또는 데이터 프레임
  FUN, # 적용할 함수
  ..., # 추가 인자. 이 인자들은 FUN에 전달된다.
)
반환 값은 FUN의 결과가 길이 1인 벡터들이면 벡터, 길이가 1보다 큰 벡터들이면 행렬이다.
```

